<ion-header>
  <ion-toolbar color="primary">
    <ion-title>üìù Mis Tareas</ion-title>
    <ion-buttons slot="end">
      <ion-button routerLink="/categories">
        <ion-icon slot="icon-only" name="pricetags-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <!-- Filtro por categor√≠as -->
  <div class="filter-scroll">
    <ion-chip
      [class.active-chip]="selectedCategoryId === null"
      (click)="filterBy(null)">
      <ion-label>Todas</ion-label>
    </ion-chip>
    <ion-chip
      *ngFor="let cat of categories"
      [style.--color]="cat.color"
      [class.active-chip]="selectedCategoryId === cat.id"
      (click)="filterBy(cat.id)">
      <ion-icon name="pricetag" [style.color]="cat.color"></ion-icon>
      <ion-label>{{ cat.name }}</ion-label>
    </ion-chip>
  </div>

  <!-- Formulario nueva tarea -->
  <ion-card class="add-card">
    <ion-card-content>
      <ion-item lines="none">
        <ion-input
          [(ngModel)]="newTodoText"
          placeholder="Nueva tarea..."
          (keyup.enter)="addTodo()">
        </ion-input>
      </ion-item>
      <ion-item lines="none">
        <ion-label>Categor√≠a</ion-label>
        <ion-select [(ngModel)]="selectedNewTodoCategoryId" placeholder="Sin categor√≠a">
          <ion-select-option [value]="null">Sin categor√≠a</ion-select-option>
          <ion-select-option *ngFor="let cat of categories" [value]="cat.id">
            {{ cat.name }}
          </ion-select-option>
        </ion-select>
      </ion-item>
      <ion-button expand="block" (click)="addTodo()" class="ion-margin-top">
        <ion-icon slot="start" name="add"></ion-icon>
        Agregar Tarea
      </ion-button>
    </ion-card-content>
  </ion-card>

  <!-- Lista de tareas -->
  <ion-list>
    <ion-item-sliding *ngFor="let todo of filteredTodos; trackBy: trackById">
      <ion-item [class.completed-item]="todo.completed">
        <ion-checkbox
          slot="start"
          [checked]="todo.completed"
          (ionChange)="toggleTodo(todo)">
        </ion-checkbox>
        <ion-label>
          <h2 [class.completed-text]="todo.completed">{{ todo.text }}</h2>
          <p *ngIf="getCategoryById(todo.categoryId) as cat">
            <ion-icon name="pricetag" [style.color]="cat.color"></ion-icon>
            {{ cat.name }}
          </p>
        </ion-label>
      </ion-item>
      <ion-item-options side="end">
        <ion-item-option color="danger" (click)="deleteTodo(todo)">
          <ion-icon slot="icon-only" name="trash"></ion-icon>
        </ion-item-option>
      </ion-item-options>
    </ion-item-sliding>
  </ion-list>

  <!-- Estado vac√≠o -->
  <div *ngIf="filteredTodos.length === 0" class="empty-state">
    <ion-icon name="checkmark-done-circle-outline"></ion-icon>
    <p>No hay tareas aqu√≠</p>
  </div>

</ion-content>